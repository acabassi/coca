---
title: "R package coca"
author: "Alessandra Cabassi"
date: "`r Sys.Date()`"
output: 
  knitr:::html_vignette
vignette: >
  %\VignetteIndexEntry{R package klic}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The R package `coca` (**C**luster-**O**f-**C**lusters **A**nalysis) contains a collection of tools for integrative clustering of multiple data types. 

The main functions are:

* `coca`.
* `consensusCluster`.

# COCA

COCA is an integrative clustering method proposed by The Cancer Genome Atlas (TGCA) in 2012. Its functioning is explained in detail in Cabassi & Kirk (2018).

```{r preparation_coca, fig.show='hold', message=FALSE, warning=FALSE, cache=TRUE}
### Load data ###
data <- list()
data[[1]] <- as.matrix(read.csv(system.file("extdata", 
                      "dataset1.csv", package = "coca"), row.names = 1))
data[[2]] <- as.matrix(read.csv(system.file("extdata", 
                      "dataset2.csv", package = "coca"), row.names = 1))
data[[3]] <- as.matrix(read.csv(system.file("extdata", 
                      "dataset3.csv", package = "coca"), row.names = 1))

### Set constants ###
n_datasets <- 3
n_clusters <- 6
N <- 300
true_labels <- as.matrix(read.csv(system.file("extdata",
                         "cluster_labels.csv", package = "coca"), row.names = 1))

### Fill label matrix with clusterings found with the k-means clustering algorithm ###
labelMatrix <- array(NA, c(n_clusters, N, n_datasets))
for(i in 1:n_datasets){
  output <- kmeans(data[[i]], n_clusters)
  for(k in 1:n_clusters){
    labelMatrix[k,,i] <- (output$cluster==k)
  }
}
# Convert label matrix from logic to numeric matrix
labelMatrix <- labelMatrix*1
```

`labelMatrix` is now a matrix that contains the binary labels of the data given by the k-means clustering algorithm for each dataset separately.

```{r coca, fig.show='hold', message=FALSE, warning=FALSE, cache=TRUE}
### COCA ###
# Build MOC matrix
MOC <- rbind(labelMatrix[,,1],labelMatrix[,,2], labelMatrix[,,3])
# Use COCA to find global clustering
coca <- coca(t(MOC), K = 6, hclustMethod = "average")
# Compare clustering to the true labels
ari <- mclust::adjustedRandIndex(true_labels, coca$clusterLabels)
ari
```

# References 

Cabassi, A. and Kirk, P. D. W. (2018). Multiple kernel learning for integrative consensus clustering. In preparation.

Monti, S. et al. (2003). Consensus Clustering: A Resampling-Based Method for Class Discovery and Visualization of Gene. Machine Learning, 52(i), 91–118.

The Cancer Genome Atlas (2012). Comprehensive molecular portraits of human breast tumours. Nature,
487(7407), 61–70.
